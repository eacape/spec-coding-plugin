<idea-plugin>
    <id>com.eacape.speccodingplugin</id>
    <name>Spec Coding Plugin</name>
    <vendor email="team@eacape.com" url="https://eacape.com">Eacape</vendor>

    <description><![CDATA[
        Spec-driven AI coding workflow for JetBrains IDEs.
    ]]></description>

    <depends>com.intellij.modules.platform</depends>

    <resource-bundle>messages.SpecCodingBundle</resource-bundle>

    <extensions defaultExtensionNs="com.intellij">
        <toolWindow
                id="Spec Coding"
                factoryClass="com.eacape.speccodingplugin.ui.ChatToolWindowFactory"
                anchor="right"
                canCloseContents="false"/>

        <notificationGroup
                id="SpecCoding.Notifications"
                displayType="BALLOON"
                isLogByDefault="true"/>

        <!-- Application-level Services -->
        <applicationService serviceImplementation="com.eacape.speccodingplugin.ui.settings.SpecCodingSettingsState"/>
        <applicationService serviceImplementation="com.eacape.speccodingplugin.prompt.GlobalPromptManager"/>
        <applicationService serviceImplementation="com.eacape.speccodingplugin.llm.ModelRegistry"/>
        <applicationService serviceImplementation="com.eacape.speccodingplugin.window.WindowRegistry"/>
        <applicationService serviceImplementation="com.eacape.speccodingplugin.window.GlobalConfigSyncService"/>

        <!-- Project-level Services -->
        <projectService serviceImplementation="com.eacape.speccodingplugin.core.SpecCodingProjectService"/>
        <projectService serviceImplementation="com.eacape.speccodingplugin.core.OperationModeManager"/>
        <projectService serviceImplementation="com.eacape.speccodingplugin.prompt.PromptManager"/>
        <projectService serviceImplementation="com.eacape.speccodingplugin.skill.SkillRegistry"/>
        <projectService serviceImplementation="com.eacape.speccodingplugin.skill.SkillExecutor"/>
        <projectService serviceImplementation="com.eacape.speccodingplugin.spec.SpecEngine"/>
        <projectService serviceImplementation="com.eacape.speccodingplugin.spec.SpecDeltaService"/>
        <projectService serviceImplementation="com.eacape.speccodingplugin.session.SessionManager"/>
        <projectService serviceImplementation="com.eacape.speccodingplugin.mcp.McpHub"/>
        <projectService serviceImplementation="com.eacape.speccodingplugin.mcp.McpConfigStore"/>
        <projectService serviceImplementation="com.eacape.speccodingplugin.window.WindowStateStore"/>
        <projectService serviceImplementation="com.eacape.speccodingplugin.window.WindowSessionIsolationService"/>
        <projectService serviceImplementation="com.eacape.speccodingplugin.rollback.ChangesetStore"/>
        <projectService serviceImplementation="com.eacape.speccodingplugin.rollback.RollbackManager"/>
        <projectService serviceImplementation="com.eacape.speccodingplugin.engine.EngineManager"/>
        <projectService serviceImplementation="com.eacape.speccodingplugin.hook.HookConfigStore"/>
        <projectService serviceImplementation="com.eacape.speccodingplugin.hook.HookExecutor"/>
        <projectService serviceImplementation="com.eacape.speccodingplugin.hook.HookManager"/>

        <!-- Context Engine Services -->
        <projectService serviceImplementation="com.eacape.speccodingplugin.context.ContextCollector"/>
        <projectService serviceImplementation="com.eacape.speccodingplugin.context.ProjectStructureScanner"/>
        <projectService serviceImplementation="com.eacape.speccodingplugin.context.RelatedFileDiscovery"/>

        <!-- Completion Service -->
        <projectService serviceImplementation="com.eacape.speccodingplugin.ui.completion.CompletionProvider"/>

        <!-- Status Bar Widget -->
        <statusBarWidgetFactory implementation="com.eacape.speccodingplugin.ui.ModelSelectorWidgetFactory" order="first"/>

        <!-- Settings Page -->
        <projectConfigurable
                parentId="tools"
                instance="com.eacape.speccodingplugin.ui.settings.SpecCodingSettingsConfigurable"
                id="com.eacape.speccodingplugin.settings"
                displayName="Spec Coding"/>
    </extensions>

    <projectListeners>
        <listener
                class="com.eacape.speccodingplugin.window.WindowRegistryProjectManagerListener"
                topic="com.intellij.openapi.project.ProjectManagerListener"/>
        <listener
                class="com.eacape.speccodingplugin.hook.HookProjectManagerListener"
                topic="com.intellij.openapi.project.ProjectManagerListener"/>
    </projectListeners>

    <applicationListeners>
        <listener
                class="com.eacape.speccodingplugin.hook.HookFileSaveListener"
                topic="com.intellij.openapi.fileEditor.FileDocumentManagerListener"/>
    </applicationListeners>

    <actions>
        <action
                id="SpecCoding.OpenChat"
                class="com.eacape.speccodingplugin.ui.actions.OpenSpecCodingToolWindowAction"
                text="%action.open.toolwindow.text"
                description="%action.open.toolwindow.description">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>
    </actions>
</idea-plugin>
